# WHU-STU-CHAT
C#大作业团队仓库——武汉大学学生互助交流平台

## 项目简介
WHU-STU-CHAT是一个专为武汉大学学生设计的互助交流平台，提供即时通讯、AI助手、社区讨论等功能，旨在促进校园内部的沟通与信息共享。

## 版本信息
- **当前版本**: V0.2（正式版）
- **最新更新时间**: 2025-5-21
- **更新人**: EaXon

## 已实现功能

### 聊天系统
- **公共聊天室**: 提供5个预设的公共聊天区域，支持文本和表情
- **私聊功能**: 支持用户间一对一聊天，显示在线状态，发送文件和Emoji
- **群聊功能**: 创建、加入和管理群聊，支持群成员管理
- **AI智能助手**: 集成AI模型，提供问答服务，支持多轮对话，保存聊天历史

### 用户系统
- **用户注册登录**: 完整的注册、登录功能，支持会话保持
- **好友系统**: 添加好友、好友请求管理、好友列表显示
- **在线状态管理**: 显示用户在线/离线状态，支持隐藏在线状态
- **通知系统**: 好友请求、系统通知等消息提醒

### 社区功能
- **话题讨论区**: 支持多个讨论主题，发布和回复帖子
- **匿名发帖**: 支持匿名发表帖子和评论
- **点赞功能**: 支持对帖子点赞

### 用户设置
- **个人资料管理**: 修改头像、签名等个人信息
- **通知设置**: 消息免打扰、在线状态显示等设置

### 群组聊天
- **群组的管理**: 管理员权限下的创建、添加与删除
- **群组聊天**： 在同一群组下实时发送信息，表情，图片功能



## 待开发功能
1. 文件传输功能改进
2. 更多社区互动功能
3. 移动端适配优化

## 安装指南

### 前端部署
```bash
# 进入前端目录
cd frontend/whu-chat-frontend

# 安装依赖
npm install

# 运行开发服务器
npm run serve

# 构建生产环境版本
npm run build
```

### 后端部署
```bash
# 进入后端目录
cd backend

# 还原NuGet包
dotnet restore

# 构建项目
dotnet build

# 运行项目
dotnet run
```

### 数据库部署
1. 在MySQL中创建名为`whu-chat`的数据库
2. 执行`sql-data/whu-chat-v1.sql`脚本创建表结构和初始数据
3. 在`backend/appsettings.json`中配置数据库连接字符串

## 使用指南

### 登录和注册
- 打开应用后，输入用户名和密码登录
- 首次使用请点击注册按钮创建账号
- 测试账号: username: "Mike", password: "123456"

### 聊天功能
- 主页面可以查看和进入公共聊天室
- 点击好友列表中的用户可以发起私聊
- 创建或加入群组可以参与群聊
- 点击AI助手图标启动智能对话

### 社区互动
- 在"讨论区"标签页浏览不同主题的讨论
- 点击发帖按钮创建新的帖子
- 可以对帖子进行评论和点赞操作

### 个人设置
- 点击右上角头像进入个人设置
- 可以管理个人资料、通知设置和隐私选项

## 技术栈

### 前端技术
- **核心框架**: Vue.js 3 + Composition API
- **构建工具**: Vite (快速的开发服务器和优化的构建工具)
- **UI组件**: 自定义组件系统 + CSS3动画效果
- **状态管理**: Vue 3 Reactive + Pinia
- **网络请求**: Axios + 请求拦截器
- **实时通信**: SignalR 客户端 + WebSocket
- **优化技术**: 
  * 虚拟滚动列表 (处理大量消息)
  * 懒加载组件和资源
  * 组件级别缓存策略
  * 压缩和代码分割

### 后端技术
- **核心框架**: ASP.NET Core 7 Web API
- **实时通信**: SignalR Hub + WebSocket长连接
- **AI集成**: 
  * DeepSeek AI API (基础模型)
  * ChatGPT API (VIP用户特权)
  * 自定义AI提示工程
- **认证授权**: JWT身份验证 + 基于角色的权限控制
- **性能优化**:
  * 异步任务处理
  * 消息队列
  * 缓存策略
  * 并发控制

### 数据存储与处理
- **关系型数据库**: MySQL 8.0
  * 优化索引设计
  * 高效查询策略
  * 事务管理
- **缓存系统**: Redis (消息和用户状态缓存)
- **文件存储**: 阿里云OSS (头像和文件存储)
- **数据访问**: 高效的ORM映射 + 原生SQL优化+阿里RDS

### 通信技术
- **API设计**: RESTful API + 自定义状态码
- **实时通信协议**: WebSocket + SignalR协议
- **数据格式**: JSON + 自定义压缩算法
- **通信安全**: HTTPS + 数据加密

### 云服务集成
- **对象存储**: 阿里云OSS (用户上传文件与头像)
- **CDN加速**: 静态资源分发
- **推送服务**: 离线消息通知

### 开发与部署
- **版本控制**: Git + GitHub 工作流
- **CI/CD**: 自动化测试 + 部署脚本
- **容器化**: Docker配置 (可选部署方式)
- **监控**: 日志系统 + 性能监控

## 贡献者
- Eaxon: 项目架构、后端开发
- Mike: 前端开发
- Shiro: 数据库设计
- Tom: AI功能实现

## 故障排除

### 常见问题
1. 数据库连接失败: 检查MySQL服务是否运行，连接字符串是否正确
2. 前端构建错误: 确保Node.js版本>= 14.0，重新安装依赖
3. 聊天功能不可用: 检查SignalR连接状态，可能是跨域问题

### 联系支持
如遇问题请提交Issue或联系开发团队: whu-chat-team@example.com

## todo
1. 私聊功能V2
2. 好友界面设计
3. 个人信息修改
4. 群组高级功能


## 更新内容（5-21）0.2.0

1. 后端API完善
   - 修复了会员等级信息传递问题
   - 修改UserService，在用户信息中添加会员等级字段
   - 修复ChatService，确保在线用户信息包含会员等级
   - 优化数据库查询，添加Level字段到查询结果中

2. 前端会员显示优化
   - 改进会员等级显示，解决VIP和SVIP用户标识问题
   - 优化了用户卡片组件中会员等级的显示
   - 为不同会员等级添加了醒目的视觉标识

3. 用户体验改进
   - 优化聊天界面的消息布局
   - 调整自己发言气泡框的位置，使其显示在右侧，符合主流聊天应用习惯
   - 改进消息气泡的样式，增强视觉区分度
   - 修复文本对齐和头像位置问题

技术要点：
- 完善了前后端数据传输字段的一致性
- 优化了用户界面的直觉性和易用性
- 提高了用户信息呈现的完整性

修改人：EaXon


## 更新内容（5-21）0.2.0（正式版初版）

1. 后端API完善
   - 修复了会员等级信息传递问题
   - 修改UserService，在用户信息中添加会员等级字段
   - 修复ChatService，确保在线用户信息包含会员等级
   - 优化数据库查询，添加Level字段到查询结果中

2. 前端会员显示优化
   - 改进会员等级显示，解决VIP和SVIP用户标识问题
   - 优化了用户卡片组件中会员等级的显示
   - 为不同会员等级添加了醒目的视觉标识

3. 用户体验改进
   - 优化聊天界面的消息布局
   - 调整自己发言气泡框的位置，使其显示在右侧，符合主流聊天应用习惯
   - 改进消息气泡的样式，增强视觉区分度
   - 修复文本对齐和头像位置问题

技术要点：
- 完善了前后端数据传输字段的一致性
- 优化了用户界面的直觉性和易用性
- 提高了用户信息呈现的完整性

修改人：EaXon


## 更新内容（5-19）0.1.6T

1. 实现会员等级逻辑和AI模型访问控制
   - 普通用户只能使用基础模型（Deepseek）
   - VIP用户可以使用基础模型和GPT-3.5
   - SVIP用户可以使用所有AI模型

2. 实现/接入模拟会员系统，来实现仿真性
   - 简化了支付接口的访问权限
   - 实现了模拟支付+会员系统

3. 优化前端界面
   - 改进了AIChat.vue组件的会员等级显示和模型选择逻辑

技术要点：
- 使用Vue.js实现了前端会员等级逻辑
- 移除了不必要的JWT身份验证配置

修改人：侯宜辰


## 更新内容（5-16）0.1.5T

1. 重构群组/私聊核心逻辑
   - 优化了消息发送和接收的实时性
   - 修复了群组消息重复发送的问题
   - 改进了私聊消息的存储和检索机制
   - 实现了消息发送失败的重试机制
   - 优化了消息加载性能，采用分页加载

2. 数据库优化与调试
   - 重构了用户关系表结构，提高查询效率
   - 优化了消息表的索引设计
   - 添加了消息状态追踪字段
   - 实现了数据库连接池管理
   - 添加了数据库操作日志记录

3. 接入阿里云OSS服务
   - 实现了个人头像上传功能
     * 支持图片压缩和格式转换
     * 添加了图片大小限制
     * 实现了图片预览功能
   - 实现了文件上传功能
     * 支持多种文件格式
     * 添加了文件大小限制
     * 实现了上传进度显示
     * 添加了文件类型验证

4. 会员系统框架搭建
   - 设计了会员等级体系
   - 实现了会员权限控制
   - 添加了会员专属功能入口
   - 预留了支付接口
   - 设计了会员状态管理机制

技术要点：
- 使用SignalR实现了实时消息推送
- 采用阿里云OSS SDK进行文件存储
- 使用Redis缓存优化数据访问
- 实现了基于JWT的身份认证
- 采用EF Core进行数据库操作

修改人：侯宜辰


## 更新内容（5-15）

1. 修复了私聊离线状态判断问题
   - 每次加入或离开私聊会广播状态
   - 查询对方用户在线状态
   - 修复了主页上好友在线状态显示的问题

2. 实现私聊文件发送
   - 直接通过绑定消息类型的方式发送文件
   - 可以下载到本地，实现了文件传输

3. 实现私聊emoji发送
   - 增加了一系列emoji列表
   - 丰富聊天内容和趣味性

## 更新内容（5-11）
1. 修复了用户在线/离线状态判断问题
   - 聊天室中的在线用户现在正确反映实际在聊天室内的用户
   - 用户退出聊天室后会立即从在线用户列表中移除
   - 修复了主页上好友在线状态显示的问题

2. 实现了好友系统功能重构与完善
   - 集成数据库Friendships表进行好友关系管理
   - 在聊天室的在线用户界面添加了用户名片显示
   - 新增了向聊天室用户发送好友请求功能(带验证消息)
   - 为用户名片添加了多种状态显示(已是好友/请求待处理/被拒绝等)
   - 优化了好友请求通知的显示与处理流程

3. 优化了系统架构
   - 添加了FriendshipService服务管理好友关系
   - 完善了通知管理系统与用户状态同步机制

## 更新内容（5-7）
1. 完成了群组搜索功能
2. 修改了几个小bug
3. 初步完成了好友功能
4. 完善了群组聊天的页面

## 更新内容（4-28）
1. 完成并测试了群聊的后端与后端
2. 聊天成员表删除了1列
3. 融入框架了

## 更新内容（4-28）
1.实现AI对话咨询板块
2.实现AI接入聊天室进行总结
3.聊天室支持多媒体聊天（包含表情包/图片）
4.实现主页基础架构
